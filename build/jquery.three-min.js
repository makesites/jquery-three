/**
 * @name jquery.three
 * jQuery Three() - jQuery extension with 3D methods (using Three.js)
 * Version: 0.9.8 (Sun, 11 Dec 2016 10:59:18 GMT)
 *
 * @author makesites
 * Created by: Makis Tracend (@tracend)
 *
 * Homepage: http://github.com/makesites/jquery-three
 * @license MIT License
 */
window.requestAnimFrame=function(e){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),function(e,t){var a=e.$||e.jQuery||e.ender;"function"==typeof define&&define.amd?define(["jquery"],t):t(a)}(this,function(e){function t(e,t){if(e=e||{},e.material)if(e.material.materials)for(var a in e.material.materials)e.material.materials[a].color.setHex(t);else e.material.color.setHex(t)}function a(){for(var e in this._animations){var t=this._animations[e],a=t.keyframes;t.start=t.start||d.now(),t.end=t.end||t.start+t.duration,t.offset=t.offset||r(this),t.count=t.count||0;var i=d.now(),n=(i-t.start)/t.duration*100,s=!1,o=!1;for(var c in a)n>=c&&(s=a[c]),c>n&&!o&&(o=a[c]);s||(s=a[0]),o||(o=a[100]);var h={x:"undefined"!=typeof s.rotation.x&&"undefined"!=typeof o.rotation.x?(o.rotation.x-s.rotation.x)*(n/100):0,y:"undefined"!=typeof s.rotation.y&&"undefined"!=typeof o.rotation.y?(o.rotation.y-s.rotation.y)*(n/100):0,z:"undefined"!=typeof s.rotation.z&&"undefined"!=typeof o.rotation.z?(o.rotation.z-s.rotation.z)*(n/100):0};if(this.rotation.set(t.offset.rotation.x+h.x,t.offset.rotation.y+h.y,t.offset.rotation.z+h.z),this instanceof THREE.Sprite){var l={x:this.material.map.offset.x,y:this.material.map.offset.y},u=t.easing,p=100/u,f=parseInt(n,10)%p===0?parseInt(n,10)/100:0;f&&(f-=1/u,"undefined"!=typeof t.keyframes[0]["background-position"].x&&(l.x=(u-1)/u-f),"undefined"!=typeof t.keyframes[0]["background-position"].y&&(l.y=(u-1)/u-f),this.material.map.offset.set(l.x,l.y))}n>=100&&(delete t.start,delete t.end,delete t.offset,t.count++),t.count==t.repeat?delete this._animations[e]:this._animations[e]=t}}function r(e){return{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}}function i(e){for(var t=document.styleSheets,a=0;a<t.length;++a)for(var r=0;r<t[a].cssRules.length;++r)if(t[a].cssRules[r].type==window.CSSRule.WEBKIT_KEYFRAMES_RULE&&t[a].cssRules[r].name==e)return t[a].cssRules[r];return null}var n,s={},o={self:function(){return this}},c={alpha:!0,clock:!0,watch:!1,deps:{THREE:"https://raw.github.com/mrdoob/three.js/master/build/three.min.js"},paused:!1};Three=function(t,a,r){var i=this;this.el=this.setEl(t),this.options=e.extend(!0,{},c,a),this.objects={},this.scenes={},this.cameras={},this.terrains={},this.materials={},this.groups={camera:"cameras",scene:"scenes",terrain:"terrains",mesh:"objects",plane:"objects",cube:"objects",sphere:"objects",cylinder:"objects",material:"materials"},this.options.clock&&(this.clock=new THREE.Clock),this.frame={current:0,rate:0,date:new Date},this.last=!1,this.parent=!1,this.dependencies(function(){i.init(),r instanceof Function&&r(i)})},Three.prototype={init:function(){var t=this;this.active={scene:!1,camera:!1,skybox:!1},this.properties=this.setProperties(),this.renderer=new THREE.WebGLRenderer({alpha:this.options.alpha}),this.renderer.setSize(this.properties.width,this.properties.height),this.renderer.autoClear=!1,e(this.el).find(".fallback").remove();var a=e(this.el).html();e(this.el).html("<shadow-root></shadow-root>"),this.parent=e(this.el).find("shadow-root"),this.target=this.parent,this.html(a),e(this.renderer.domElement).appendTo(this.el),window.addEventListener("resize",function(){t.resize()},!1),this.options.watch&&this.watch(this.parent),this.tick()},destroy:function(){return this.each(function(){var t=e(this);t.data("three");t.removeData("three")})},self:function(t,a){var r=[];return this.each(function(){var i=e(this),n=i.data("three");n||(n=new Three(this,t,a),e(this).data("three",n)),r.push(n)}),1==r.length?r[0]:e(r)},tick:function(){var e=this;this.options.paused||this.render();var t=new Date;this.frame.date.getSeconds()===t.getSeconds()?this.frame.current++:(this.frame.rate=this.frame.current,this.frame.current=1,this.frame.date=t),requestAnimFrame(function(){e.tick()})},render:function(){if(this.active.scene&&this.active.camera){if(this.active.skybox){var t=this.active.camera.far,a=this.active.skybox.scale;a.x!==t&&(a.x=a.y=a.z=t);var r=this.active.camera.position;this.active.skybox.position.set(r.x,r.y,r.z)}this.renderer.render(this.active.scene,this.active.camera)}this.fn.animate.update(),e(this.el).trigger({type:"update",target:this})},show:function(){},hide:function(){},update:function(e){},detect:function(){return{canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,all:function(){return this.webgl&&this.canvas&&this.workers&&this.fileapi}}},resize:function(){this.properties=this.setProperties();for(var e in this.cameras)this.cameras[e].aspect=this.properties.aspect,this.cameras[e].updateProjectionMatrix();this.renderer.setSize(this.properties.width,this.properties.height)},dependencies:function(t){var a=e.map(this.options.deps,function(e,t){return window[t]||window.THREE&&window.THREE[t]?void 0:e});a.length?this.loadScripts(a,t):t()},loadScripts:function(t,a){var r=this;e.when(e.getScript(t.shift())).done(function(){t.length>0?r.loadScripts(t,a):a()})},setEl:function(t){var a=e(this).attr("id");return"undefined"!=typeof a&&a!==!1||e(t).addClass("3d-"+d.unid()),t}},e.fn.three=function(e,t){e||(e=!1),t||(t=function(e){return e});return Three.prototype.self.apply(this,arguments,e,t)},Three.prototype.getAttributes=function(t){var a={};return e(t).each(function(){var e=this.attributes;for(var t in e)if(e[t].name&&0===e[t].name.search("data-")){var r=e[t].name.replace("data-","");r=d.camelCase(r);var i=e[t].value;a[r]=parseInt(i,10)||"0"===i?parseInt(i,10):i,"false"!==a[r]&&"true"!==a[r]||(a[r]=JSON.parse(a[r]))}else if(e[t].name&&0===e[t].name.search("class")){var n=e[t].value.split(" ");a["class"]=n}else e[t].name&&0===e[t].name.search("src")?a.src=e[t].value:e[t].name&&0===e[t].name.search("style")&&(a.style=e[t].value)}),a},Three.prototype.addClass=function(t){var a=this.last,r=e(this.el).find("[data-id='"+a.id+"']");r.addClass(t);var i=this.fn.css.styles.call(this,r);return this.fn.css.set.call(this,a,i),this},n=function(e){return this.fn.css.set.call(this,this.last,e),this},o.css={styles:function(t){var a=document.styleSheets,r={};for(var i in a){var n=a[i].rules||a[i].cssRules;for(var s in n)if(!(n[s].selectorText&&n[s].selectorText.search(":hover")>-1||n[s].selectorText&&n[s].selectorText.search("::before")>-1||n[s].selectorText&&n[s].selectorText.search("::after")>-1))try{t.is(n[s].selectorText)&&(r=e.extend(r,h(n[s].style)))}catch(o){console.log(o)}}return r=e.extend(r,h(t.attr("style")))},set:function(e,a){if(e&&e.id)for(var r in a){var i=r.replace("-webkit-","").replace("-moz-","");e._style=e._style||{},e._shaders=e._shaders||{};var n=!e._style[i]||e._style[i]!=a[r];if(e._style[i]=a[r],n)switch(i){case"width":e.scale.x=parseInt(a[r],10);break;case"height":e.scale.y=parseInt(a[r],10);break;case"top":e.position.y=parseInt(a[r],10);break;case"left":e.position.x=parseInt(a[r],10);break;case"color":var s=this.colorToHex(a[r]);e instanceof THREE.Scene?this.webglLight({color:s}):t(e,s);break;case"transform":var o;a[r].search("translate3d")>-1&&(o=this.fn.css.translate.call(this,a[r]),e instanceof THREE.Mesh&&"terrain"!=e.type?e.parent.position.set(o.x,o.y,o.z):e.position.set(o.x,o.y,o.z)),a[r].search("rotate3d")>-1&&(o=this.fn.css.rotate.call(this,a[r]),e instanceof THREE.Mesh&&"terrain"!=e.type?e.parent.rotation.set(o.x,o.y,o.z):e.rotation.set(o.x,o.y,o.z)),a[r].search("scale3d")>-1&&(o=this.fn.css.scale.call(this,a[r]),e instanceof THREE.Mesh&&"terrain"!=e.type?e.parent.scale.set(o.x,o.y,o.z):e.scale.set(o.x,o.y,o.z));break;case"animation-duration":this.fn.css.animation.duration=1e3*parseInt(a[r],10);break;case"animation-timing":this.fn.css.animation.easing=a[r];break;case"animation-delay":this.fn.css.animation.delay=a[r];break;case"animation-iteration-count":this.fn.css.animation.repeat=a[r];break;case"animation-direction":this.fn.css.animation.direction=a[r];break;case"animation-fill-mode":this.fn.css.animation.fill=a[r];break;case"animation-name":this.fn.css.animation.name=a[r],this.animate(this.fn.css.animation,e),this.fn.css.animation={};break;case"animation-timing-function":var c=a[r].match(/steps\((\d)/);this.fn.css.animation.easing=c?parseInt(c[1],10):a[r];break;case"animation-play-state":this.fn.css.animation.state=a[r];break;case"display":break;case"background-image":if(e instanceof THREE.Scene)this.fn.css.skybox.call(this,a[r]);else if("terrain"==e.type)this.fn.css.terrain.call(this,a[r]);else if(e instanceof THREE.Mesh)this.fn.css.texture.call(this,e,a[r]);else if(e instanceof THREE.Object3D&&e.children.length)try{var h=e.children[0];this.fn.css.texture.call(this,h,a[r])}catch(l){console.log(l)}else if(e instanceof THREE.Sprite){var u=a[r].replace(/\s|url\(|"|'|\)/g,"");e.material.map=d.textureLoader(u)}break;case"background-size":e instanceof THREE.Sprite&&this.fn.css.sprite.call(this,e,a[r]);break;case"background-position-x":e instanceof THREE.Sprite&&this.fn.css.sprite.call(this,e);break;case"background-position-y":e instanceof THREE.Sprite&&this.fn.css.sprite.call(this,e);break;case"filter":var p,f;e instanceof THREE.Mesh&&e.parent instanceof THREE.Object3D?(p=e.parent,f=e.parent.$el):(p=e,f=e.$el);var m=a[r].replace(/url\(|"|'|\)/g,"").split("|");if(!m.length)break;p._shaders=p._shaders||{};for(var g in m){var v=m[g].substring(m[g].lastIndexOf("/")+1);p._shaders[v]=d.getFile(m[g])}p.getShader=function(e){return this._shaders[e]||null},f.trigger("css-filter")}}},animation:{},rotate:function(e){var t,a={};return e.search("rotate3d")>-1?(t=e.match(/rotate3d\(([\s\S]*?)\)/gi),t=t[0].replace(/rotate3d\(|deg|\)| /gi,"").split(","),a={x:parseFloat(t[0],10)*parseFloat(t[3],10)*(Math.PI/180),y:parseFloat(t[1],10)*parseFloat(t[3],10)*(Math.PI/180),z:parseFloat(t[2],10)*parseFloat(t[3],10)*(Math.PI/180)}):e.search("rotateX")>-1?(t=e.match(/rotateX\(([\s\S]*?)\)/gi),t=t[0].replace(/rotateX\(|deg|\)| /gi,"").rot={x:parseFloat(t,10)*(Math.PI/180)}):e.search("rotateY")>-1?(t=e.match(/rotateY\(([\s\S]*?)\)/gi),t=t[0].replace(/rotateY\(|deg|\)| /gi,""),a={y:parseFloat(t,10)*(Math.PI/180)}):e.search("rotateZ")>-1?(t=e.match(/rotateZ\(([\s\S]*?)\)/gi),t=t[0].replace(/rotateZ\(|deg|\)| /gi,""),a={z:parseFloat(t,10)*(Math.PI/180)}):e.search("rotate")>-1&&(t=e.match(/rotate\(([\s\S]*?)\)/gi),t=t[0].replace(/rotate\(|deg|\)| /gi,""),a={z:parseFloat(t,10)*(Math.PI/180)}),a},translate:function(e){var t={};if(e.search("translate3d")>-1){var a=e.match(/translate3d\(([\s\S]*?)\)/gi);a=a[0].replace(/translate3d\(|px|\)| /gi,"").split(","),t={x:parseFloat(a[0],10)||0,y:parseFloat(a[1],10)||0,z:parseFloat(a[2],10)||0}}return t},scale:function(e){var t={};if(e.search("scale3d")>-1){var a=e.match(/scale3d\(([\s\S]*?)\)/gi);a=a[0].replace(/scale3d\(|\)| /gi,"").split(","),t={x:parseFloat(a[0],10)||0,y:parseFloat(a[1],10)||0,z:parseFloat(a[2],10)||0}}return t},texture:function(e,t){var a,r=t.replace(/\s|url\(|"|'|\)/g,"").split(",");if(r.length>1){var i={},n={},s=(new THREE.CubeTextureLoader).load(r);if(s.format=THREE.RGBFormat,i.tCube={type:"t",value:s},e._shaders)for(var o in e._shaders){var c=e._shaders[o];o.indexOf(".fs")>-1&&(n.fragmentShader=c),o.indexOf(".vs")>-1&&(n.vertexShader=c)}n.uniforms=i,n.needsUpdate=!0,a=new THREE.ShaderMaterial(n)}else a=this.webglMaterial({map:r[0]});e.material=a},terrain:function(e){var t=this.last,a=e.match(/url\(\s*[\'"]?(([^\\\\\'" \(\)]*(\\\\.)?)+)[\'"]?\s*\)/gim);if(a instanceof Array){var r,i,n;for(var s in a)a[s]=a[s].replace(/\s|url\(|"|'|\)/g,""),a[s].search("heightmap")>-1&&(r=t.updateTexture("heightmap",a[s])),a[s].search("diffuse")>-1&&(i=t.updateTexture("diffuse",a[s])),a[s].search("specular")>-1&&(n=t.updateTexture("specular",a[s]));!r&&a[0]&&t.updateTexture("heightmap",a[0]),!i&&a[1]&&t.updateTexture("diffuse",a[1]),!n&&a[2]&&t.updateTexture("specular",a[2])}else t.updateTexture("heightmap",a),t.updateTexture("diffuse",a)},skybox:function(e){var t=e.replace(/\s|url\(|"|'|\)/g,"").split(",");t instanceof Array&&this.addSkybox(t)},sprite:function(e,t){var a=setInterval(function(){if(e.material.map.image&&e.material.map.image.width){t=t||e._style["background-size"]||"0 0";var r=t.split(" "),i=parseFloat(r[0],10),n=parseFloat(r[1],10),s=parseFloat(e._style["background-position-x"]||0),o=parseFloat(e._style["background-position-y"]||0);if(i&&n){var c=e.material.map.image.width,h=e.material.map.image.height;e.material.map.offset.set((c-i-s)/c,(h-n-o)/h),e.material.map.repeat.set(i/c,n/h),clearInterval(a)}}},200)}};var h=function(e){var t={};if(!e)return t;if(e instanceof CSSStyleDeclaration)for(var a in e)e[a].toLowerCase&&(t[e[a].toLowerCase()]=e[e[a]]);else if("string"==typeof e){e=e.split("; ");for(var r in e){var i=e[r].split(": ");t[i[0].toLowerCase()]=i[1]}}return t};Three.prototype.animate=function(e,t){if(e=e||{},t=t||this.last||!1,t instanceof THREE.Mesh&&t.parent instanceof THREE.Object3D&&(t=t.parent),t&&e.name&&(t._animations=t._animations||{},t._update=t._update||a.bind(t),e.keyframes=this.fn.animate.getKeyframes.call(this,e.name),e.keyframes)){t._animations[e.name]=e;var r="undefined"!=typeof this.fn.animate.queue[t.uuid];r||(this.fn.animate.queue[t.uuid]=t._update)}},o.animate={queue:{},getKeyframes:function(e){var t={},a=i(e);if(a){for(var r in a.cssRules){var n=a.cssRules[r],s={};if(n.keyText){var o,c=parseInt(n.keyText,10);s.rotation=this.fn.css.rotate(n.cssText),s.translation=this.fn.css.translate(n.cssText),s.scale=this.fn.css.scale(n.cssText),n.cssText.search("background-position-x")>-1&&(s["background-position"]=s["background-position"]||{},o=n.cssText.match(/:[\d|\s|\w]+\;/),o&&(s["background-position"].x=parseFloat(o[0].substr(1),10))),n.cssText.search("background-position-y")>-1&&(s["background-position"]=s["background-position"]||{},o=n.cssText.match(/:[\d|\s|\w]+\;/),o&&(s["background-position"].y=parseFloat(o[0].substr(1),10))),t[c]=s}}return t}},update:function(e){for(var t in this.queue)this.queue[t]()}},Three.prototype.fx=function(){},Three.prototype.watch=function(t){function a(e){var t=e.target,a=e.attributeName,i=e.target.getAttribute(a);e.oldValue;if("style"==a){var n=r.objects[t.getAttribute("data-id")]||r.active.terrain,s=n.children[0]||n,o=h(i);r.last=s,r.fn.css.set.call(r,s,o)}}var r=this,i=e(t).selector||"shadow-root",n=(e(this.el).toSelector()+" "+i,document.getElementById("main").querySelector("shadow-root")),s=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,o={childList:!0,attributes:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["class","style"]},c=new s(function(t){e.each(t,function(e,t){var a=t;"childList"===t.type?t.addedNodes.length>0?r.eventSubtree(a):t.removedNodes.length>0:"attributes"===t.type&&"class"===t.attributeName&&r.eventAttribute(a)})});c.observe(n,o);var l=new s(function(e){e.forEach(a)});l.observe(n,{childList:!1,attributes:!0,subtree:!0,attributeFilter:["class","style"]})},Three.prototype.eventSubtree=function(t){var a=e(e(this.el).toSelector()+" shadow-root").get(0),r=e(t.target).get(0);if(this.parent=a==r?e(t.target):e(t.target).parent(),this.target=e(t.target),0!==t.target.innerHTML.length){var i=e(t.target).html();this.append(i,{silent:!0,target:this.target,traverse:!1,watch:!0})}},Three.prototype.eventAttribute=function(e){console.log("attribute",e.target)},Three.prototype.add=function(e,t){var a=this;return t=t||{},"undefined"==typeof e||"undefined"==typeof e.type?this:(this.webgl(e,function(r){if(!r||"undefined"==typeof r)return this;var i;a.last=r;var n=a.groups[e.type]||!1;if("objects"==n&&r instanceof THREE.Mesh?(i=new THREE.Object3D,i.add(r),i.name=r.name):i=r,a.active[e.type]=i,e["data-id"]=i.id||!1,!e.el.data("id")){var s;t.silent&&e.el?(s=e.el,s.attr("data-id",e["data-id"])):(s=a.createHTML(e),a.target=s),i.$el=s;var o=a.fn.css.styles.call(a,s);a.fn.css.set.call(a,r,o),n&&(a[n][i.id]=i),"scene"==e.type?a.active.scene=i:a.active.scene&&a.active.scene.add(i)}}),this)},Three.prototype.addScene=function(e){var t=e||{};return t.type="scene",this.add(t),this},Three.prototype.addCamera=function(e){var t=e||{};return t.type="camera",this.add(t),this},Three.prototype.addMesh=function(e){var t=e||{};return t.type="mesh",this.add(t),this},Three.prototype.addPlane=function(e){var t=e||{};return t.type="plane",this.add(t),this},Three.prototype.addSphere=function(e){var t=e||{};return t.type="sphere",this.add(t),this},Three.prototype.addCube=function(e){var t=e||{};return t.type="cube",this.add(t),this},Three.prototype.addCylinder=function(e){var t=e||{};return t.type="cylinder",this.add(t),this},Three.prototype.addAsset=function(e){var t=e||{};return t.type="asset",this.add(t),this},Three.prototype.addSkybox=function(e){var t,a;if(1==e.length)t=new THREE.SphereGeometry(1,60,40),t.applyMatrix((new THREE.Matrix4).makeScale(-1,1,1)),a=new THREE.MeshBasicMaterial({map:d.textureLoader(e[0])});else{var r;if(THREE.REVISION<70)r=THREE.ImageUtils.loadTextureCube(e);else{var i=new THREE.CubeTextureLoader;r=i.load(e)}r.format=THREE.RGBFormat;var n=THREE.ShaderLib.cube,s=THREE.UniformsUtils.clone(n.uniforms);s.tCube.value=r,a=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:s,depthWrite:!1,side:THREE.BackSide}),t=new THREE.BoxGeometry(1,1,1)}var o=new THREE.Mesh(t,a);this.active.scene.add(o),this.active.skybox=o},Three.prototype.addTerrain=function(e){var t=e||{};return t.type="terrain",this.add(t),this},Three.prototype.html=function(t,a){var r=this;return a=a||{},a.target=a.target||this.target,"undefined"==typeof a.traverse&&(a.traverse=!0),e(t).filter("*").each(function(t,i){var n="undefined"==typeof i?!1:e(i);if(n&&"undefined"==typeof n.attr("data-id")){var s={};s.type=i.nodeName.toLowerCase(),s.id=n.attr("id");var o=r.getAttributes(i);s=e.extend(s,o),s.el=a.target.children(":eq("+t+")"),a.watch&&!s.el.length||(r.add(s,a),""!==n.html()&&a.traverse&&r.html(n.html(),a))}}),this},Three.prototype.createHTML=function(t){var a=e("<"+t.type+">");if(t.id&&a.attr("id",t.id),t["data-id"]&&a.attr("data-id",t["data-id"]),t["class"]&&t["class"].length){var r=t["class"].join(" ");a.attr("class",r)}return t.style&&a.attr("style",t.style),a.appendTo(this.parent),"scene"!=t.type&&"asset"!=t.type&&"player"!=t.type||(this.parent=a),a},Three.prototype.append=function(e,t){return t=t||{},this.html(e,t),this},Three.prototype.get=function(e){var t=this.objects[e]||this.cameras[e]||this.scenes[e]||this.terrains[e]||null;return t},find=function(e){var t=this.fn.find.el.call(this,e);return this.last=t,this},o.find={el:function(t){var a=e(this.el).find("shadow-root "+t).attr("data-id"),r=this.objects[a]||this.cameras[a]||this.scenes[a]||this.terrains[a]||null;return r}},o.three=function(e,t){var a=this.last;try{a[e](t)}catch(r){console.log("Method not supported:",r)}return this};var l=function(e){this.options=e;var t=e.resolution,a=e.resolution,r=new THREE.PlaneBufferGeometry(e.width,e.height,t,a);r.computeFaceNormals(),r.computeVertexNormals(),d.computeTangents(r);var i=e.shader?this.shaderMaterial():this.basicMaterial(),n=new THREE.Mesh(r,i);return n.type="terrain",n._attributes=e,e.shader?n.updateTexture=this.shaderTexture.bind(n):(n.computeElevation=this.computeElevation.bind(n),n.updateTexture=this.basicTexture.bind(n)),this.terrain=n,this};l.prototype.shaderMaterial=function(){if(!THREE.ShaderTerrain)return console.log("THREE.ShaderTerrain not loaded. Use data-shader='false' to generate a poly terrain");var e=this.options,t=THREE.ShaderTerrain.terrain,a=THREE.UniformsUtils.clone(t.uniforms);THREE.REVISION<70?(a.uDiffuseColor.value.setHex(16777215),a.uSpecularColor.value.setHex(16777215),a.uAmbientColor.value.setHex(1118481)):(a.diffuse.value.setHex(16777215),a.specular.value.setHex(16777215)),a.uRepeatOverlay.value.set(e.repeat,e.repeat);var r=new THREE.ShaderMaterial({uniforms:a,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,lights:e.lights,fog:e.fog,needsUpdate:!0});return r},l.prototype.basicMaterial=function(){var e=new THREE.MeshBasicMaterial({map:d.pixel(),overdraw:.5});return e},l.prototype.computeElevation=function(e){if(!this._attributes.shader){var t=this,a=document.createElement("canvas"),r=a.getContext("2d"),i=e.image,n=t.geometry.parameters.widthSegments+1,s=t.geometry.parameters.heightSegments+1,o=t._attributes.scale,c=-t._attributes.scale/2,h=(t.geometry.parameters.width,t.geometry.attributes.position),l=[];a.width=n,a.height=s,r.drawImage(i,0,0,i.width,i.height,0,0,n,s);var d=r.getImageData(0,0,n,s).data;for(var u in d)if(!(u%4)){var p=d[u]/255*o+c;l.push(p),h.setZ(u/4,p)}t.geometry.attributes.position.needsUpdate=!0}},l.prototype.shaderTexture=function(e,t){var a=d.textureLoader(t);if("heightmap"==e){var r=this._attributes.scale;this.material.uniforms.tDisplacement.value=a,this.material.uniforms.uDisplacementScale.value=r,this.material.uniforms.uDisplacementBias.value=-r/2}return"diffuse"==e&&(a.wrapS=a.wrapT=THREE.RepeatWrapping,this.material.uniforms.tDiffuse1.value=a,this.material.uniforms.enableDiffuse1.value=!0),"specular"==e&&(this.material.uniforms.tSpecular.value=a,this.material.uniforms.enableSpecular.value=!0),a},l.prototype.basicTexture=function(e,t){var a;if("heightmap"==e){a=d.textureLoader(t,"heightmap-loaded");var r=this,i=function(e){r.computeElevation(a),r.$el.trigger("heightmap-updated")};document.removeEventListener("heightmap-loaded",i),document.addEventListener("heightmap-loaded",i,!1)}if("diffuse"==e){a=d.textureLoader(t);var n=this._attributes.repeat;a.wrapT=THREE.RepeatWrapping,a.wrapS=THREE.RepeatWrapping,a.repeat.set(n,n),a.needsUpdate=!0,this.material.map=a}return a},Three.prototype.webgl=function(e,t){var a;switch(e.type){case"scene":a=this.webglScene(e);break;case"camera":a=this.webglCamera(e);break;case"mesh":a=this.webglMesh(e);break;case"material":a=this.webglMaterial(e);break;case"light":a=this.webglLight(e);break;case"plane":a=this.webglPlane(e);break;case"sphere":a=this.webglSphere(e);break;case"cube":a=this.webglCube(e);break;case"cylinder":a=this.webglCylinder(e);break;case"sprite":a=this.webglSprite(e);break;case"terrain":a=this.webglTerrain(e);break;default:"undefined"!=typeof this.fn.webgl[e.type]&&this.fn.webgl[e.type].apply(this,[e,t])}return t(a)},o.webgl={},Three.prototype.webglScene=function(t){var a={id:!1},r=e.extend(a,t),i=new THREE.Scene;return this.scenes[i.id]=i,i._attributes=r,i},Three.prototype.webglCamera=function(t){var a,r={fov:50,aspect:this.properties.aspect,near:1,far:1e3,scene:this.active.scene},i=e.extend(r,t);return i.orthographic||(a=new THREE.PerspectiveCamera(i.fov,i.aspect,i.near,i.far)),a._attributes=i,a},Three.prototype.webglMesh=function(t){var a,r={id:!1,wireframe:!1,scene:this.active.scene};e.extend(r,t);return a},Three.prototype.webglMaterial=function(t){var a,r,i={id:!1,color:0,wireframe:!1,map:!1,scene:this.active.scene},n=e.extend(i,t),s=window.Shaders||{};if(n.id&&s[n.id]){r={};var o=Shaders[n.id];o.uniforms&&(r.uniforms=THREE.UniformsUtils.clone(o.uniforms)),o.vertexShader&&(r.vertexShader=o.vertexShader),o.fragmentShader&&(r.fragmentShader=o.fragmentShader),n.map&&o.uniforms&&(r.uniforms.texture.texture=d.textureLoader(n.map)),a=new THREE.ShaderMaterial(r)}else r={},n.map&&(r.map=d.textureLoader(n.map)),n.color&&!n.map&&(r.color=n.color),n.wireframe&&(r.wireframe=n.wireframe),a=new THREE.MeshBasicMaterial(r);return a},Three.prototype.webglTexture=function(e){var t=new THREE.Texture,a=new THREE.ImageLoader;return a.addEventListener("load",function(e){t.image=e.content,t.needsUpdate=!0}),a.load(e),t},Three.prototype.webglLight=function(e){this.active.scene.add(new THREE.AmbientLight(parseInt(e.color,16)))},Three.prototype.webglPlane=function(t){var a={width:1,height:1,color:0,wireframe:!1,scene:this.active.scene},r=e.extend(a,t),i=r.buffer?THREE.PlaneBufferGeometry:THREE.PlaneGeometry,n=new i(r.width,r.height);n.dynamic=!0;var s=new THREE.MeshBasicMaterial({color:r.color,wireframe:r.wireframe}),o=new THREE.Mesh(n,s);return r.id&&(o.name=r.id),o._attributes=r,o},Three.prototype.webglSphere=function(t){var a={id:!1,radius:1,segments:16,rings:16,color:0,wireframe:!1,map:!1,scene:this.active.scene},r=e.extend(a,t),i=new THREE.SphereGeometry(r.radius,r.segments,r.rings);i.dynamic=!0;var n=this.webglMaterial(r),s=new THREE.Mesh(i,n);return s.matrixAutoUpdate=!1,r.id&&(s.name=r.id),s._attributes=r,s},Three.prototype.webglCube=function(t){var a={id:!1,width:1,height:1,depth:1,color:0,wireframe:!1,scene:this.active.scene},r=e.extend(a,t),i=new THREE.BoxGeometry(r.width,r.height,r.depth);i.dynamic=!0;var n=new THREE.MeshBasicMaterial({color:r.color,wireframe:r.wireframe}),s=new THREE.Mesh(i,n);return r.id&&(s.name=r.id),s._attributes=r,s},Three.prototype.webglCylinder=function(t){var a={id:!1,radiusTop:1,radiusBottom:1,segmentsRadius:4,segmentsHeight:16,openEnded:!1,color:0,wireframe:!1,scene:this.active.scene},r=e.extend(a,t),i=new THREE.CylinderGeometry(r.radiusTop,r.radiusBottom,r.segmentsRadius,r.segmentsHeight,r.openEnded,!1);i.dynamic=!0;var n=new THREE.MeshBasicMaterial({color:r.color,wireframe:r.wireframe}),s=new THREE.Mesh(i,n);return r.id&&(s.name=r.id),s._attributes=r,s},Three.prototype.webglSprite=function(t){t=t||{};var a={map:!1,color:16777215,fog:!1,transparent:!0,opacity:1},r=e.extend(a,t);t.map?r.map=d.textureLoader(t.map):r.map=d.pixel();var i=r.id;delete r.id,delete r["class"],delete r.el,delete r.style;var n=new THREE.SpriteMaterial(r);n.scaleByViewport=!0,n.blending=THREE.AdditiveBlending;var s=new THREE.Sprite(n);return s.name=i,s._attributes=r,s},Three.prototype.webglTerrain=function(t){t=t||{};var a={lights:!0,fog:!0,scale:256,width:6e3,height:6e3,resolution:256,shader:!0,repeat:1},r=e.extend(a,t),i=new l(r).terrain;return this.active.scene.add(i),i},Three.prototype.colorToHex=function(e){if("#"===e.substr(0,1))return e.replace("#","0x");var t=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e),a=parseInt(t[2],10).toString(16),r=parseInt(t[3],10).toString(16),i=parseInt(t[4],10).toString(16);return 1==a.length&&(a="0"+a),1==r.length&&(r="0"+r),1==i.length&&(i="0"+i),"0x"+a+r+i},Three.prototype.setProperties=function(){return{width:e(this.el).width(),height:e(this.el).height(),aspect:e(this.el).width()/e(this.el).height()}};var d={camelCase:function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})},delay:function(e,t){t=t||0;var a=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return e.apply(null,a)},t)},unid:function(){return Math.round(Math.random()*(new Date).getTime())},now:function(){return performance&&performance.now?Math.floor(performance.now()):(new Date).getTime()},pixel:function(){var e=document.createElement("img"),t=new THREE.Texture(e);return e.addEventListener("load",function(e){t.needsUpdate=!0}),e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",t},textureLoader:function(e,t){var a=this.pixel();return THREE.REVISION<70?(e.search(";base64,")>-1&&(e=e.replace(/data:image\/(png|jpg|jpeg);base64,/,"")),a=THREE.ImageUtils.loadTexture(e)):(new THREE.TextureLoader).load(e,function(e){if(a.image=e.image,a.needsUpdate=!0,t){var r=new Event(t);document.dispatchEvent(r)}}),a},getHeightData:function(e){var t=document.createElement("canvas");t.width=128,t.height=128;var a=t.getContext("2d"),r=16384,i=new Float32Array(r);a.drawImage(e,0,0);for(var n=0;r>n;n++)i[n]=0;for(var s=a.getImageData(0,0,128,128),o=s.data,c=0,h=0,l=o.length;l>h;h+=4){var d=o[h]+o[h+1]+o[h+2];i[c++]=d/30}return i},getFile:function(t){return s[t]?s[t]:(s[t]=e.ajax({type:"GET",url:t,dataType:"string",async:!1,success:function(e){s[t]=e}}).responseText,s[t])},
// @author mrdoob / http://mrdoob.com/
computeTangents:function(e){function t(e,t,a){v.fromArray(s,3*e),y.fromArray(s,3*t),w.fromArray(s,3*a),E.fromArray(c,2*e),T.fromArray(c,2*t),b.fromArray(c,2*a);var r=y.x-v.x,i=w.x-v.x,n=y.y-v.y,o=w.y-v.y,h=y.z-v.z,l=w.z-v.z,p=T.x-E.x,f=b.x-E.x,m=T.y-E.y,g=b.y-E.y,H=1/(p*g-f*m);x.set((g*r-m*i)*H,(g*n-m*o)*H,(g*h-m*l)*H),R.set((p*i-f*r)*H,(p*o-f*n)*H,(p*l-f*h)*H),d[e].add(x),d[t].add(x),d[a].add(x),u[e].add(R),u[t].add(R),u[a].add(R)}function a(e){C.fromArray(o,3*e),L.copy(C),z=d[e],I.copy(z),I.sub(C.multiplyScalar(C.dot(z))).normalize(),_.crossVectors(L,z),F=_.dot(u[e]),M=0>F?-1:1,l[4*e]=I.x,l[4*e+1]=I.y,l[4*e+2]=I.z,l[4*e+3]=M}var r=e.index,i=e.attributes;if(null===r||void 0===i.position||void 0===i.normal||void 0===i.uv)return void console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var n=r.array,s=i.position.array,o=i.normal.array,c=i.uv.array,h=s.length/3;void 0===i.tangent&&e.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*h),4));for(var l=i.tangent.array,d=[],u=[],p=0;h>p;p++)d[p]=new THREE.Vector3,u[p]=new THREE.Vector3;var f,m,g,v=new THREE.Vector3,y=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector2,T=new THREE.Vector2,b=new THREE.Vector2,x=new THREE.Vector3,R=new THREE.Vector3,H=e.groups;0===H.length&&(H=[{start:0,count:n.length}]);for(var S=0;S<H.length;++S){f=H[S],m=f.start,g=f.count;for(var k=m,A=m+g;A>k;k+=3)t(n[k+0],n[k+1],n[k+2])}for(var M,z,F,I=new THREE.Vector3,_=new THREE.Vector3,C=new THREE.Vector3,L=new THREE.Vector3,B=0;B<H.length;++B){f=H[B],m=f.start,g=f.count;for(var j=m,V=m+g;V>j;j+=3)a(n[j+0]),a(n[j+1]),a(n[j+2])}}};!function(e){e.fn.toSelector=function(){var t=e(this).get(0),a=t.tagName.toLowerCase(),r=e(this).attr("id"),i=t.className.split(/\s+/),n=a;return"undefined"!=typeof r&&(n+="#"+r),"undefined"!=typeof i&&(n+="."+i.join(".")),n}}(jQuery),Three.prototype.css=n,Three.prototype.find=find,Three.prototype.fn=o,Three.prototype.lookAt=function(){return this.fn.three.call(this,"lookAt",arguments)}});